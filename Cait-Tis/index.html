<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cait-Lab å¤šæœåŠ¡å™¨ç½‘é€Ÿæµ‹è¯•å·¥å…·</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a237e 0%, #311b92 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00e5ff, #00ff9d);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .server-selection {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .test-controls {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .results {
            flex: 2;
            min-width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #00e5ff;
            border-bottom: 2px solid rgba(0, 229, 255, 0.3);
            padding-bottom: 8px;
        }
        
        h3 {
            font-size: 1.4rem;
            margin: 25px 0 15px 0;
            color: #00ff9d;
        }
        
        .server-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        
        .server-item {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .server-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }
        
        .server-item.selected {
            background: rgba(0, 229, 255, 0.2);
            border-color: #00e5ff;
        }
        
        .server-flag {
            font-size: 1.8rem;
            margin-right: 12px;
        }
        
        .server-info h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .server-info p {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .btn {
            display: inline-block;
            background: linear-gradient(90deg, #00e5ff, #00ff9d);
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            margin-top: 10px;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn-group .btn {
            flex: 1;
        }
        
        .test-options {
            margin-top: 20px;
        }
        
        .option-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
        }
        
        .option-item label {
            font-weight: 600;
        }
        
        select, input[type="number"] {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .progress-container {
            margin-top: 25px;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .progress-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00e5ff, #00ff9d);
            border-radius: 6px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .test-status {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            min-height: 60px;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .result-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.12);
        }
        
        .result-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 10px 0;
            color: #00ff9d;
        }
        
        .result-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .chart-container {
            margin-top: 30px;
            height: 300px;
        }
        
        .server-results {
            margin-top: 25px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .server-result-item {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .server-result-info {
            display: flex;
            align-items: center;
        }
        
        .server-result-info i {
            font-size: 1.5rem;
            margin-right: 15px;
        }
        
        .server-result-stats {
            text-align: right;
        }
        
        .ping {
            color: #00e5ff;
        }
        
        .download {
            color: #00ff9d;
        }
        
        .upload {
            color: #ff9800;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.8;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .server-list {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-tachometer-alt"></i> Cait-Lab ç½‘é€Ÿæµ‹è¯•å·¥å…·</h1>
            <p class="subtitle">ç²¾ç¡®æµ‹è¯•æ‚¨çš„äº’è”ç½‘è¿æ¥é€Ÿåº¦ã€‚é€‰æ‹©å¤šä¸ªå›½å†…å’Œå›½å¤–æœåŠ¡å™¨è¿›è¡Œä¸‹è½½é€Ÿåº¦ã€ä¸Šä¼ é€Ÿåº¦å’Œå»¶è¿Ÿæµ‹è¯•ã€‚</p>
        </header>
        
        <div class="main-content">
            <div class="server-selection">
                <h2>æœåŠ¡å™¨é€‰æ‹©</h2>
                <p>é€‰æ‹©è¦æµ‹è¯•çš„æœåŠ¡å™¨ï¼ˆå¯å¤šé€‰ï¼‰ï¼š</p>
                
                <h3><i class="fas fa-flag"></i> å›½å†…æœåŠ¡å™¨</h3>
                <div class="server-list" id="chinaServers">
                    <!-- å›½å†…æœåŠ¡å™¨å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                </div>
                
                <h3><i class="fas fa-globe"></i> å›½å¤–æœåŠ¡å™¨</h3>
                <div class="server-list" id="internationalServers">
                    <!-- å›½å¤–æœåŠ¡å™¨å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                </div>
                
                <div class="btn-group" style="margin-top: 25px;">
                    <button class="btn" id="selectAllBtn">
                        <i class="fas fa-check-double"></i> å…¨é€‰
                    </button>
                    <button class="btn" id="deselectAllBtn">
                        <i class="fas fa-times"></i> å–æ¶ˆå…¨é€‰
                    </button>
                </div>
            </div>
            
            <div class="test-controls">
                <h2>æµ‹è¯•è®¾ç½®</h2>
                
                <div class="test-options">
                    <div class="option-item">
                        <label for="testType"><i class="fas fa-cogs"></i> æµ‹è¯•ç±»å‹</label>
                        <select id="testType">
                            <option value="all">å…¨éƒ¨æµ‹è¯• (ä¸‹è½½+ä¸Šä¼ +å»¶è¿Ÿ)</option>
                            <option value="download">ä»…ä¸‹è½½é€Ÿåº¦</option>
                            <option value="upload">ä»…ä¸Šä¼ é€Ÿåº¦</option>
                            <option value="ping">ä»…å»¶è¿Ÿæµ‹è¯•</option>
                        </select>
                    </div>
                    
                    <div class="option-item">
                        <label for="fileSize"><i class="fas fa-database"></i> æµ‹è¯•æ–‡ä»¶å¤§å°</label>
                        <select id="fileSize">
                            <option value="small">å°å‹ (1 MB)</option>
                            <option value="medium" selected>ä¸­å‹ (5 MB)</option>
                            <option value="large">å¤§å‹ (10 MB)</option>
                            <option value="custom">è‡ªå®šä¹‰å¤§å°</option>
                        </select>
                    </div>
                    
                    <div class="option-item" id="customSizeContainer" style="display: none;">
                        <label for="customSize"><i class="fas fa-edit"></i> è‡ªå®šä¹‰å¤§å° (MB)</label>
                        <input type="number" id="customSize" min="1" max="50" value="10">
                    </div>
                    
                    <div class="option-item">
                        <label for="testCount"><i class="fas fa-redo"></i> æ¯ä¸ªæœåŠ¡å™¨æµ‹è¯•æ¬¡æ•°</label>
                        <select id="testCount">
                            <option value="1">1æ¬¡</option>
                            <option value="2">2æ¬¡</option>
                            <option value="3" selected>3æ¬¡</option>
                            <option value="5">5æ¬¡</option>
                        </select>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn" id="startTestBtn">
                        <i class="fas fa-play"></i> å¼€å§‹æµ‹è¯•
                    </button>
                    <button class="btn" id="stopTestBtn" disabled>
                        <i class="fas fa-stop"></i> åœæ­¢æµ‹è¯•
                    </button>
                </div>
                
                <div class="progress-container">
                    <div class="progress-info">
                        <span id="progressText">å‡†å¤‡æµ‹è¯•...</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
                
                <div class="test-status" id="testStatus">
                    é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨å¹¶ç‚¹å‡»"å¼€å§‹æµ‹è¯•"æŒ‰é’®
                </div>
            </div>
            
            <div class="results">
                <h2>æµ‹è¯•ç»“æœ</h2>
                
                <div class="result-grid">
                    <div class="result-card">
                        <div class="result-label">å¹³å‡ä¸‹è½½é€Ÿåº¦</div>
                        <div class="result-value" id="avgDownload">0 Mbps</div>
                        <div class="result-label">æ‰€æœ‰æµ‹è¯•æœåŠ¡å™¨</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-label">å¹³å‡ä¸Šä¼ é€Ÿåº¦</div>
                        <div class="result-value" id="avgUpload">0 Mbps</div>
                        <div class="result-label">æ‰€æœ‰æµ‹è¯•æœåŠ¡å™¨</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-label">å¹³å‡å»¶è¿Ÿ</div>
                        <div class="result-value" id="avgPing">0 ms</div>
                        <div class="result-label">æ‰€æœ‰æµ‹è¯•æœåŠ¡å™¨</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-label">æœ€ä½³æœåŠ¡å™¨</div>
                        <div class="result-value" id="bestServer">-</div>
                        <div class="result-label">æœ€ä½å»¶è¿Ÿ</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="speedChart"></canvas>
                </div>
                
                <div class="server-results">
                    <h3>æœåŠ¡å™¨è¯¦ç»†ç»“æœ</h3>
                    <div id="serverResultsList">
                        <!-- æœåŠ¡å™¨ç»“æœå°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Cait-Lab ç½‘é€Ÿæµ‹è¯•å·¥å…· &copy; 2023 | æ­¤å·¥å…·å®Œå…¨åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œä¸ä¼šä¸Šä¼ ä»»ä½•æ•°æ®åˆ°æœåŠ¡å™¨</p>
            <p>æ³¨æ„ï¼šå®é™…æµ‹è¯•é€Ÿåº¦å¯èƒ½å—æµè§ˆå™¨ã€è®¾å¤‡æ€§èƒ½ã€ç½‘ç»œçŠ¶å†µç­‰å¤šç§å› ç´ å½±å“</p>
        </footer>
    </div>

    <script>
        // æœåŠ¡å™¨æ•°æ®
        const servers = {
            china: [
                { id: 'cn-beijing', name: 'åŒ—äº¬', flag: 'ğŸ‡¨ğŸ‡³', location: 'ä¸­å›½åŒ—äº¬', provider: 'ä¸­å›½ç”µä¿¡' },
                { id: 'cn-shanghai', name: 'ä¸Šæµ·', flag: 'ğŸ‡¨ğŸ‡³', location: 'ä¸­å›½ä¸Šæµ·', provider: 'ä¸­å›½ç”µä¿¡' },
                { id: 'cn-guangzhou', name: 'å¹¿å·', flag: 'ğŸ‡¨ğŸ‡³', location: 'ä¸­å›½å¹¿å·', provider: 'ä¸­å›½ç”µä¿¡' },
                { id: 'cn-shenzhen', name: 'æ·±åœ³', flag: 'ğŸ‡¨ğŸ‡³', location: 'ä¸­å›½æ·±åœ³', provider: 'ä¸­å›½è”é€š' },
                { id: 'cn-chengdu', name: 'æˆéƒ½', flag: 'ğŸ‡¨ğŸ‡³', location: 'ä¸­å›½æˆéƒ½', provider: 'ä¸­å›½ç§»åŠ¨' },
                { id: 'cn-wuhan', name: 'æ­¦æ±‰', flag: 'ğŸ‡¨ğŸ‡³', location: 'ä¸­å›½æ­¦æ±‰', provider: 'ä¸­å›½ç”µä¿¡' },
                { id: 'cn-hangzhou', name: 'æ­å·', flag: 'ğŸ‡¨ğŸ‡³', location: 'ä¸­å›½æ­å·', provider: 'é˜¿é‡Œå·´å·´äº‘' },
                { id: 'cn-chongqing', name: 'é‡åº†', flag: 'ğŸ‡¨ğŸ‡³', location: 'ä¸­å›½é‡åº†', provider: 'ä¸­å›½è”é€š' },
                { id: 'cn-tianjin', name: 'å¤©æ´¥', flag: 'ğŸ‡¨ğŸ‡³', location: 'ä¸­å›½å¤©æ´¥', provider: 'ä¸­å›½ç§»åŠ¨' },
                { id: 'cn-nanjing', name: 'å—äº¬', flag: 'ğŸ‡¨ğŸ‡³', location: 'ä¸­å›½å—äº¬', provider: 'ä¸­å›½ç”µä¿¡' }
            ],
            international: [
                { id: 'us-newyork', name: 'çº½çº¦', flag: 'ğŸ‡ºğŸ‡¸', location: 'ç¾å›½çº½çº¦', provider: 'Amazon AWS' },
                { id: 'us-sanjose', name: 'åœ£ä½•å¡', flag: 'ğŸ‡ºğŸ‡¸', location: 'ç¾å›½åŠ å·', provider: 'Google Cloud' },
                { id: 'jp-tokyo', name: 'ä¸œäº¬', flag: 'ğŸ‡¯ğŸ‡µ', location: 'æ—¥æœ¬ä¸œäº¬', provider: 'Amazon AWS' },
                { id: 'sg-singapore', name: 'æ–°åŠ å¡', flag: 'ğŸ‡¸ğŸ‡¬', location: 'æ–°åŠ å¡', provider: 'Google Cloud' },
                { id: 'de-frankfurt', name: 'æ³•å…°å…‹ç¦', flag: 'ğŸ‡©ğŸ‡ª', location: 'å¾·å›½æ³•å…°å…‹ç¦', provider: 'Amazon AWS' },
                { id: 'uk-london', name: 'ä¼¦æ•¦', flag: 'ğŸ‡¬ğŸ‡§', location: 'è‹±å›½ä¼¦æ•¦', provider: 'Microsoft Azure' },
                { id: 'au-sydney', name: 'æ‚‰å°¼', flag: 'ğŸ‡¦ğŸ‡º', location: 'æ¾³å¤§åˆ©äºšæ‚‰å°¼', provider: 'Amazon AWS' },
                { id: 'ca-toronto', name: 'å¤šä¼¦å¤š', flag: 'ğŸ‡¨ğŸ‡¦', location: 'åŠ æ‹¿å¤§å®‰å¤§ç•¥', provider: 'Google Cloud' },
                { id: 'kr-seoul', name: 'é¦–å°”', flag: 'ğŸ‡°ğŸ‡·', location: 'éŸ©å›½é¦–å°”', provider: 'Amazon AWS' },
                { id: 'in-mumbai', name: 'å­Ÿä¹°', flag: 'ğŸ‡®ğŸ‡³', location: 'å°åº¦å­Ÿä¹°', provider: 'Microsoft Azure' }
            ]
        };

        // æµ‹è¯•ç»“æœå­˜å‚¨
        let testResults = [];
        let selectedServers = [];
        let isTesting = false;
        let currentTestIndex = 0;
        let totalTests = 0;
        let completedTests = 0;
        let speedChart = null;

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // æ¸²æŸ“æœåŠ¡å™¨åˆ—è¡¨
            renderServerList('chinaServers', servers.china);
            renderServerList('internationalServers', servers.international);
            
            // åˆå§‹åŒ–å›¾è¡¨
            initializeChart();
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
            
            // è®¾ç½®æ–‡ä»¶å¤§å°é€‰æ‹©å™¨çš„è‡ªå®šä¹‰é€‰é¡¹
            document.getElementById('fileSize').addEventListener('change', function() {
                const customSizeContainer = document.getElementById('customSizeContainer');
                customSizeContainer.style.display = this.value === 'custom' ? 'flex' : 'none';
            });
        });
        
        // æ¸²æŸ“æœåŠ¡å™¨åˆ—è¡¨
        function renderServerList(containerId, serverList) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            serverList.forEach(server => {
                const serverElement = document.createElement('div');
                serverElement.className = 'server-item';
                serverElement.dataset.id = server.id;
                
                serverElement.innerHTML = `
                    <div class="server-flag">${server.flag}</div>
                    <div class="server-info">
                        <h4>${server.name}</h4>
                        <p>${server.provider}</p>
                    </div>
                `;
                
                serverElement.addEventListener('click', function() {
                    toggleServerSelection(server.id);
                });
                
                container.appendChild(serverElement);
            });
        }
        
        // åˆ‡æ¢æœåŠ¡å™¨é€‰æ‹©çŠ¶æ€
        function toggleServerSelection(serverId) {
            const serverElement = document.querySelector(`.server-item[data-id="${serverId}"]`);
            
            if (selectedServers.includes(serverId)) {
                // å–æ¶ˆé€‰æ‹©
                selectedServers = selectedServers.filter(id => id !== serverId);
                serverElement.classList.remove('selected');
            } else {
                // é€‰æ‹©
                selectedServers.push(serverId);
                serverElement.classList.add('selected');
            }
            
            updateTestStatus(`å·²é€‰æ‹© ${selectedServers.length} ä¸ªæœåŠ¡å™¨`);
        }
        
        // æ›´æ–°æµ‹è¯•çŠ¶æ€
        function updateTestStatus(message) {
            document.getElementById('testStatus').textContent = message;
        }
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initializeChart() {
            const ctx = document.getElementById('speedChart').getContext('2d');
            speedChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'ä¸‹è½½é€Ÿåº¦ (Mbps)',
                            data: [],
                            backgroundColor: 'rgba(0, 229, 255, 0.7)',
                            borderColor: 'rgba(0, 229, 255, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'ä¸Šä¼ é€Ÿåº¦ (Mbps)',
                            data: [],
                            backgroundColor: 'rgba(0, 255, 157, 0.7)',
                            borderColor: 'rgba(0, 255, 157, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'å»¶è¿Ÿ (ms)',
                            data: [],
                            backgroundColor: 'rgba(255, 152, 0, 0.7)',
                            borderColor: 'rgba(255, 152, 0, 1)',
                            borderWidth: 1,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'é€Ÿåº¦ (Mbps)',
                                color: '#fff'
                            },
                            ticks: {
                                color: '#fff'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'å»¶è¿Ÿ (ms)',
                                color: '#fff'
                            },
                            ticks: {
                                color: '#fff'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        },
                        x: {
                            ticks: {
                                color: '#fff'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#fff'
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                }
            });
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // å…¨é€‰æŒ‰é’®
            document.getElementById('selectAllBtn').addEventListener('click', function() {
                selectAllServers(true);
            });
            
            // å–æ¶ˆå…¨é€‰æŒ‰é’®
            document.getElementById('deselectAllBtn').addEventListener('click', function() {
                selectAllServers(false);
            });
            
            // å¼€å§‹æµ‹è¯•æŒ‰é’®
            document.getElementById('startTestBtn').addEventListener('click', startTest);
            
            // åœæ­¢æµ‹è¯•æŒ‰é’®
            document.getElementById('stopTestBtn').addEventListener('click', stopTest);
        }
        
        // é€‰æ‹©/å–æ¶ˆé€‰æ‹©æ‰€æœ‰æœåŠ¡å™¨
        function selectAllServers(select) {
            // æ¸…é™¤å½“å‰é€‰æ‹©
            selectedServers = [];
            
            // è·å–æ‰€æœ‰æœåŠ¡å™¨å…ƒç´ 
            const serverElements = document.querySelectorAll('.server-item');
            
            serverElements.forEach(element => {
                if (select) {
                    element.classList.add('selected');
                    selectedServers.push(element.dataset.id);
                } else {
                    element.classList.remove('selected');
                }
            });
            
            updateTestStatus(select ? `å·²é€‰æ‹©æ‰€æœ‰ ${serverElements.length} ä¸ªæœåŠ¡å™¨` : 'å·²å–æ¶ˆé€‰æ‹©æ‰€æœ‰æœåŠ¡å™¨');
        }
        
        // å¼€å§‹æµ‹è¯•
        async function startTest() {
            if (selectedServers.length === 0) {
                updateTestStatus('é”™è¯¯ï¼šè¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨');
                return;
            }
            
            // ç¦ç”¨å¼€å§‹æŒ‰é’®ï¼Œå¯ç”¨åœæ­¢æŒ‰é’®
            document.getElementById('startTestBtn').disabled = true;
            document.getElementById('stopTestBtn').disabled = false;
            
            // é‡ç½®æµ‹è¯•æ•°æ®
            testResults = [];
            isTesting = true;
            currentTestIndex = 0;
            completedTests = 0;
            
            // è·å–æµ‹è¯•å‚æ•°
            const testType = document.getElementById('testType').value;
            const fileSizeOption = document.getElementById('fileSize').value;
            const testCount = parseInt(document.getElementById('testCount').value);
            
            // è®¡ç®—æµ‹è¯•æ–‡ä»¶å¤§å°
            let fileSizeMB;
            if (fileSizeOption === 'small') fileSizeMB = 1;
            else if (fileSizeOption === 'medium') fileSizeMB = 5;
            else if (fileSizeOption === 'large') fileSizeMB = 10;
            else fileSizeMB = parseInt(document.getElementById('customSize').value) || 10;
            
            // è®¡ç®—æ€»æµ‹è¯•æ¬¡æ•°
            let testsPerServer = 0;
            if (testType === 'all') testsPerServer = 3; // ä¸‹è½½ã€ä¸Šä¼ ã€å»¶è¿Ÿ
            else if (testType === 'download' || testType === 'upload') testsPerServer = 1;
            else if (testType === 'ping') testsPerServer = 1;
            
            totalTests = selectedServers.length * testsPerServer * testCount;
            
            // æ›´æ–°è¿›åº¦æ¡
            updateProgress(0, 'å¼€å§‹æµ‹è¯•...');
            
            // ä¸ºæ¯ä¸ªé€‰ä¸­çš„æœåŠ¡å™¨è¿è¡Œæµ‹è¯•
            for (const serverId of selectedServers) {
                if (!isTesting) break; // å¦‚æœç”¨æˆ·åœæ­¢äº†æµ‹è¯•
                
                // è·å–æœåŠ¡å™¨ä¿¡æ¯
                const server = [...servers.china, ...servers.international].find(s => s.id === serverId);
                
                // åˆå§‹åŒ–æœåŠ¡å™¨ç»“æœ
                const serverResult = {
                    id: serverId,
                    name: server.name,
                    flag: server.flag,
                    provider: server.provider,
                    location: server.location,
                    ping: [],
                    download: [],
                    upload: [],
                    testsCompleted: 0,
                    totalTests: testsPerServer * testCount
                };
                
                // å°†æœåŠ¡å™¨ç»“æœæ·»åŠ åˆ°æµ‹è¯•ç»“æœä¸­
                testResults.push(serverResult);
                
                // è¿è¡Œå¤šæ¬¡æµ‹è¯•
                for (let i = 0; i < testCount; i++) {
                    if (!isTesting) break;
                    
                    // è¿è¡Œå»¶è¿Ÿæµ‹è¯•
                    if (testType === 'all' || testType === 'ping') {
                        const pingResult = await runPingTest(serverId);
                        serverResult.ping.push(pingResult);
                        serverResult.testsCompleted++;
                        completedTests++;
                        updateProgress(completedTests / totalTests, `æ­£åœ¨æµ‹è¯• ${server.name} çš„å»¶è¿Ÿ (${i+1}/${testCount})...`);
                    }
                    
                    // è¿è¡Œä¸‹è½½æµ‹è¯•
                    if ((testType === 'all' || testType === 'download') && isTesting) {
                        const downloadResult = await runDownloadTest(serverId, fileSizeMB);
                        serverResult.download.push(downloadResult);
                        serverResult.testsCompleted++;
                        completedTests++;
                        updateProgress(completedTests / totalTests, `æ­£åœ¨æµ‹è¯• ${server.name} çš„ä¸‹è½½é€Ÿåº¦ (${i+1}/${testCount})...`);
                    }
                    
                    // è¿è¡Œä¸Šä¼ æµ‹è¯•
                    if ((testType === 'all' || testType === 'upload') && isTesting) {
                        const uploadResult = await runUploadTest(serverId, fileSizeMB);
                        serverResult.upload.push(uploadResult);
                        serverResult.testsCompleted++;
                        completedTests++;
                        updateProgress(completedTests / totalTests, `æ­£åœ¨æµ‹è¯• ${server.name} çš„ä¸Šä¼ é€Ÿåº¦ (${i+1}/${testCount})...`);
                    }
                    
                    // æ›´æ–°å½“å‰æœåŠ¡å™¨çš„ç»“æœ
                    updateServerResult(serverResult);
                }
            }
            
            // æµ‹è¯•å®Œæˆ
            if (isTesting) {
                updateProgress(1, 'æµ‹è¯•å®Œæˆï¼');
                updateTestStatus(`æµ‹è¯•å®Œæˆï¼å…±æµ‹è¯•äº† ${selectedServers.length} ä¸ªæœåŠ¡å™¨`);
                updateOverallResults();
            }
            
            // é‡ç½®æŒ‰é’®çŠ¶æ€
            document.getElementById('startTestBtn').disabled = false;
            document.getElementById('stopTestBtn').disabled = true;
            isTesting = false;
        }
        
        // åœæ­¢æµ‹è¯•
        function stopTest() {
            isTesting = false;
            updateTestStatus('æµ‹è¯•å·²åœæ­¢');
            document.getElementById('startTestBtn').disabled = false;
            document.getElementById('stopTestBtn').disabled = true;
        }
        
        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(progress, message) {
            const progressPercent = Math.round(progress * 100);
            document.getElementById('progressFill').style.width = `${progressPercent}%`;
            document.getElementById('progressPercent').textContent = `${progressPercent}%`;
            document.getElementById('progressText').textContent = message;
            
            if (message) {
                updateTestStatus(message);
            }
        }
        
        // è¿è¡Œå»¶è¿Ÿæµ‹è¯•
        async function runPingTest(serverId) {
            // æ¨¡æ‹Ÿå»¶è¿Ÿæµ‹è¯•ï¼ˆå®é™…åº”ç”¨ä¸­ä¼šè¿æ¥åˆ°çœŸå®æœåŠ¡å™¨ï¼‰
            // è¿™é‡Œä½¿ç”¨éšæœºå»¶è¿Ÿæ¥æ¨¡æ‹Ÿ
            const baseDelay = getBaseDelayForServer(serverId);
            const randomVariation = Math.random() * 20 - 10; // -10 åˆ° +10 ms çš„éšæœºå˜åŒ–
            const pingTime = Math.max(5, baseDelay + randomVariation);
            
            // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚çš„å»¶è¿Ÿ
            await sleep(pingTime);
            
            return pingTime;
        }
        
        // è¿è¡Œä¸‹è½½æµ‹è¯•
        async function runDownloadTest(serverId, fileSizeMB) {
            // æ¨¡æ‹Ÿä¸‹è½½æµ‹è¯•
            const baseSpeed = getBaseSpeedForServer(serverId, 'download');
            const randomVariation = Math.random() * 0.4 - 0.2; // -20% åˆ° +20% çš„éšæœºå˜åŒ–
            const speedMbps = Math.max(1, baseSpeed * (1 + randomVariation));
            
            // æ ¹æ®æ–‡ä»¶å¤§å°å’Œé€Ÿåº¦è®¡ç®—ä¸‹è½½æ—¶é—´
            const fileSizeBits = fileSizeMB * 8 * 1024 * 1024; // è½¬æ¢ä¸ºå…†ä½
            const timeSeconds = fileSizeBits / (speedMbps * 1024 * 1024); // è½¬æ¢ä¸ºç§’
            
            // æ¨¡æ‹Ÿä¸‹è½½è¿‡ç¨‹
            const chunkCount = 10;
            for (let i = 0; i < chunkCount; i++) {
                if (!isTesting) break;
                await sleep(timeSeconds * 1000 / chunkCount);
            }
            
            return speedMbps;
        }
        
        // è¿è¡Œä¸Šä¼ æµ‹è¯•
        async function runUploadTest(serverId, fileSizeMB) {
            // æ¨¡æ‹Ÿä¸Šä¼ æµ‹è¯•
            const baseSpeed = getBaseSpeedForServer(serverId, 'upload');
            const randomVariation = Math.random() * 0.4 - 0.2; // -20% åˆ° +20% çš„éšæœºå˜åŒ–
            const speedMbps = Math.max(0.5, baseSpeed * (1 + randomVariation));
            
            // æ ¹æ®æ–‡ä»¶å¤§å°å’Œé€Ÿåº¦è®¡ç®—ä¸Šä¼ æ—¶é—´
            const fileSizeBits = fileSizeMB * 8 * 1024 * 1024; // è½¬æ¢ä¸ºå…†ä½
            const timeSeconds = fileSizeBits / (speedMbps * 1024 * 1024); // è½¬æ¢ä¸ºç§’
            
            // æ¨¡æ‹Ÿä¸Šä¼ è¿‡ç¨‹
            const chunkCount = 10;
            for (let i = 0; i < chunkCount; i++) {
                if (!isTesting) break;
                await sleep(timeSeconds * 1000 / chunkCount);
            }
            
            return speedMbps;
        }
        
        // æ ¹æ®æœåŠ¡å™¨è·å–åŸºç¡€å»¶è¿Ÿ
        function getBaseDelayForServer(serverId) {
            // æ ¹æ®æœåŠ¡å™¨ä½ç½®è¿”å›æ¨¡æ‹Ÿçš„åŸºç¡€å»¶è¿Ÿ
            if (serverId.startsWith('cn-')) {
                // å›½å†…æœåŠ¡å™¨ï¼š5-50ms
                return 20 + Math.random() * 30;
            } else if (serverId.startsWith('us-')) {
                // ç¾å›½æœåŠ¡å™¨ï¼š100-200ms
                return 150 + Math.random() * 50;
            } else if (serverId.startsWith('jp-') || serverId.startsWith('kr-')) {
                // æ—¥æœ¬/éŸ©å›½æœåŠ¡å™¨ï¼š50-100ms
                return 70 + Math.random() * 30;
            } else if (serverId.startsWith('sg-')) {
                // æ–°åŠ å¡æœåŠ¡å™¨ï¼š80-120ms
                return 100 + Math.random() * 20;
            } else {
                // å…¶ä»–å›½é™…æœåŠ¡å™¨ï¼š150-300ms
                return 200 + Math.random() * 100;
            }
        }
        
        // æ ¹æ®æœåŠ¡å™¨è·å–åŸºç¡€é€Ÿåº¦
        function getBaseSpeedForServer(serverId, type) {
            // æ ¹æ®æœåŠ¡å™¨ä½ç½®è¿”å›æ¨¡æ‹Ÿçš„åŸºç¡€é€Ÿåº¦
            let baseSpeed;
            
            if (serverId.startsWith('cn-')) {
                // å›½å†…æœåŠ¡å™¨ï¼šä¸‹è½½ 50-100 Mbpsï¼Œä¸Šä¼  10-30 Mbps
                baseSpeed = type === 'download' ? 80 + Math.random() * 40 : 20 + Math.random() * 10;
            } else if (serverId.startsWith('us-') || serverId.startsWith('eu-')) {
                // æ¬§ç¾æœåŠ¡å™¨ï¼šä¸‹è½½ 30-80 Mbpsï¼Œä¸Šä¼  5-20 Mbps
                baseSpeed = type === 'download' ? 50 + Math.random() * 30 : 10 + Math.random() * 10;
            } else if (serverId.startsWith('jp-') || serverId.startsWith('kr-') || serverId.startsWith('sg-')) {
                // äºšæ´²å…¶ä»–åœ°åŒºï¼šä¸‹è½½ 40-90 Mbpsï¼Œä¸Šä¼  8-25 Mbps
                baseSpeed = type === 'download' ? 60 + Math.random() * 30 : 15 + Math.random() * 10;
            } else {
                // å…¶ä»–å›½é™…æœåŠ¡å™¨ï¼šä¸‹è½½ 20-60 Mbpsï¼Œä¸Šä¼  3-15 Mbps
                baseSpeed = type === 'download' ? 40 + Math.random() * 20 : 8 + Math.random() * 7;
            }
            
            return baseSpeed;
        }
        
        // æ›´æ–°æœåŠ¡å™¨ç»“æœ
        function updateServerResult(serverResult) {
            // è®¡ç®—å¹³å‡å€¼
            const avgPing = serverResult.ping.length > 0 ? 
                serverResult.ping.reduce((a, b) => a + b, 0) / serverResult.ping.length : 0;
            const avgDownload = serverResult.download.length > 0 ? 
                serverResult.download.reduce((a, b) => a + b, 0) / serverResult.download.length : 0;
            const avgUpload = serverResult.upload.length > 0 ? 
                serverResult.upload.reduce((a, b) => a + b, 0) / serverResult.upload.length : 0;
            
            // æ›´æ–°æœåŠ¡å™¨ç»“æœåˆ—è¡¨
            updateServerResultsList();
            
            // æ›´æ–°å›¾è¡¨
            updateChart();
        }
        
        // æ›´æ–°æœåŠ¡å™¨ç»“æœåˆ—è¡¨
        function updateServerResultsList() {
            const container = document.getElementById('serverResultsList');
            container.innerHTML = '';
            
            testResults.forEach(result => {
                // è®¡ç®—å¹³å‡å€¼
                const avgPing = result.ping.length > 0 ? 
                    result.ping.reduce((a, b) => a + b, 0) / result.ping.length : 0;
                const avgDownload = result.download.length > 0 ? 
                    result.download.reduce((a, b) => a + b, 0) / result.download.length : 0;
                const avgUpload = result.upload.length > 0 ? 
                    result.upload.reduce((a, b) => a + b, 0) / result.upload.length : 0;
                
                const resultElement = document.createElement('div');
                resultElement.className = 'server-result-item';
                resultElement.innerHTML = `
                    <div class="server-result-info">
                        <div class="server-flag">${result.flag}</div>
                        <div>
                            <h4>${result.name} - ${result.provider}</h4>
                            <p>${result.location} | å®Œæˆ ${result.testsCompleted}/${result.totalTests} é¡¹æµ‹è¯•</p>
                        </div>
                    </div>
                    <div class="server-result-stats">
                        <div class="ping"><i class="fas fa-signal"></i> ${avgPing.toFixed(1)} ms</div>
                        <div class="download"><i class="fas fa-download"></i> ${avgDownload.toFixed(1)} Mbps</div>
                        <div class="upload"><i class="fas fa-upload"></i> ${avgUpload.toFixed(1)} Mbps</div>
                    </div>
                `;
                
                container.appendChild(resultElement);
            });
        }
        
        // æ›´æ–°å›¾è¡¨
        function updateChart() {
            // å‡†å¤‡å›¾è¡¨æ•°æ®
            const labels = testResults.map(r => r.name);
            const downloadData = testResults.map(r => 
                r.download.length > 0 ? r.download.reduce((a, b) => a + b, 0) / r.download.length : 0
            );
            const uploadData = testResults.map(r => 
                r.upload.length > 0 ? r.upload.reduce((a, b) => a + b, 0) / r.upload.length : 0
            );
            const pingData = testResults.map(r => 
                r.ping.length > 0 ? r.ping.reduce((a, b) => a + b, 0) / r.ping.length : 0
            );
            
            // æ›´æ–°å›¾è¡¨
            speedChart.data.labels = labels;
            speedChart.data.datasets[0].data = downloadData;
            speedChart.data.datasets[1].data = uploadData;
            speedChart.data.datasets[2].data = pingData;
            speedChart.update();
        }
        
        // æ›´æ–°æ•´ä½“ç»“æœ
        function updateOverallResults() {
            if (testResults.length === 0) return;
            
            // è®¡ç®—æ‰€æœ‰æœåŠ¡å™¨çš„å¹³å‡å€¼
            let totalPing = 0, totalDownload = 0, totalUpload = 0;
            let pingCount = 0, downloadCount = 0, uploadCount = 0;
            let bestServer = null;
            let bestPing = Infinity;
            
            testResults.forEach(result => {
                // è®¡ç®—å»¶è¿Ÿ
                if (result.ping.length > 0) {
                    const avgPing = result.ping.reduce((a, b) => a + b, 0) / result.ping.length;
                    totalPing += avgPing;
                    pingCount++;
                    
                    // æŸ¥æ‰¾æœ€ä½³æœåŠ¡å™¨ï¼ˆæœ€ä½å»¶è¿Ÿï¼‰
                    if (avgPing < bestPing) {
                        bestPing = avgPing;
                        bestServer = result.name;
                    }
                }
                
                // è®¡ç®—ä¸‹è½½é€Ÿåº¦
                if (result.download.length > 0) {
                    const avgDownload = result.download.reduce((a, b) => a + b, 0) / result.download.length;
                    totalDownload += avgDownload;
                    downloadCount++;
                }
                
                // è®¡ç®—ä¸Šä¼ é€Ÿåº¦
                if (result.upload.length > 0) {
                    const avgUpload = result.upload.reduce((a, b) => a + b, 0) / result.upload.length;
                    totalUpload += avgUpload;
                    uploadCount++;
                }
            });
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('avgPing').textContent = pingCount > 0 ? `${(totalPing / pingCount).toFixed(1)} ms` : '0 ms';
            document.getElementById('avgDownload').textContent = downloadCount > 0 ? `${(totalDownload / downloadCount).toFixed(1)} Mbps` : '0 Mbps';
            document.getElementById('avgUpload').textContent = uploadCount > 0 ? `${(totalUpload / uploadCount).toFixed(1)} Mbps` : '0 Mbps';
            document.getElementById('bestServer').textContent = bestServer ? `${bestServer} (${bestPing.toFixed(1)} ms)` : '-';
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šå»¶è¿Ÿæ‰§è¡Œ
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>